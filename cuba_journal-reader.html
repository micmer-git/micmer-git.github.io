<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cuba Journal | Lettore fluido</title>
  <meta name="description" content="Racconto di viaggio a Cuba con lettura a corridoio e sezioni scorrevoli.">
  <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=VT323&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="viaggi/reader.css">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['"Plus Jakarta Sans"', 'sans-serif'],
            pixel: ['"VT323"', 'monospace'],
            serif: ['"Merriweather"', 'serif'],
          },
          colors: {
            'cuba-red': '#e63946',
            'cuba-blue': '#1d3557',
            'cuba-cream': '#f1faee',
            'cuba-sand': '#f6e7d7',
          },
          boxShadow: {
            neo: '4px 4px 0px 0px rgba(29,53,87,0.65)',
            'neo-sm': '2px 2px 0px 0px rgba(29,53,87,0.45)',
            'neo-hover': '6px 6px 0px 0px rgba(29,53,87,0.75)',
          }
        }
      }
    }
  </script>
  <style>
    .bg-grid-pattern {
      background-image:
        linear-gradient(to right, rgba(0,0,0,0.08) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(0,0,0,0.08) 1px, transparent 1px);
      background-size: 24px 24px;
    }
  </style>
</head>
<body class="bg-cuba-cream text-cuba-blue min-h-screen relative">
  <div class="absolute inset-0 bg-grid-pattern opacity-10"></div>
  <div class="absolute top-0 left-0 right-0 h-[35vh] bg-gradient-to-b from-cuba-red/10 via-white to-transparent"></div>
  <div class="absolute bottom-0 left-0 right-0 h-[35vh] bg-gradient-to-t from-cuba-blue/10 via-white to-transparent"></div>

  <div class="relative z-10 max-w-6xl mx-auto p-4 md:p-8 space-y-8">
    <header class="flex items-center justify-between">
      <a href="./index.html" class="inline-flex items-center gap-2 text-cuba-blue font-bold font-sans border-2 border-cuba-blue bg-white px-4 py-2 shadow-neo-sm hover:shadow-neo-hover hover:-translate-y-1 transition-all">
        <span class="text-lg">←</span>
        Torna alla home
      </a>
      <div class="px-3 py-1 border-2 border-cuba-blue bg-white font-pixel text-xl shadow-neo-sm">Viaggi</div>
    </header>

    <main class="bg-white border-4 border-cuba-blue shadow-neo p-6 md:p-10 space-y-8">
      <div class="flex flex-col gap-3 border-b-4 border-cuba-blue pb-6">
        <p class="text-sm font-mono uppercase tracking-[0.2em] text-cuba-red">Diario di viaggio</p>
        <h1 class="font-pixel text-5xl leading-tight" id="page-title">Cuba, appunti di un viaggio</h1>
        <p class="font-sans text-lg text-cuba-blue/80" id="page-tagline">Taccuino di strada tra Habana Vieja, valli di tabacco e notti di salsa</p>
      </div>

      <figure class="space-y-3" id="hero-wrapper">
        <img id="hero-image" src="https://images.unsplash.com/photo-1523906834658-6e24ef2386f9?auto=format&fit=crop&w=1600&q=80" alt="Auto d'epoca a L'Avana" class="w-full border-4 border-cuba-blue shadow-neo-sm">
      </figure>

      <div class="bg-cuba-sand border-2 border-cuba-blue shadow-neo-sm p-6 space-y-2" id="quote-box">
        <p class="text-xl italic font-serif" id="quote-text">Cuba è un'energia che vibra: ne respiri la musica nell'aria e la resilienza negli sguardi.</p>
        <p class="font-mono text-cuba-red" id="quote-author">Taccuino dell'Avana, maggio 2024</p>
      </div>

      <section class="space-y-4">
        <h2 class="font-pixel text-3xl">Leggi il racconto in modalità corridoio</h2>
        <p class="font-sans text-lg text-cuba-blue/80">Il lettore sottostante utilizza il corridoio di lettura già presente nel sito. Le sezioni vengono generate da un file JSON per aggiornare il diario senza toccare l'HTML.</p>
        <ul class="list-disc list-inside space-y-2 font-sans text-cuba-blue/80">
          <li>Scorri con frecce, Page Up/Down o barra spaziatrice.</li>
          <li>Usa i pallini laterali per saltare a una sezione.</li>
          <li>I contenuti arrivano dal file <code>cuba_journal-data.json</code>.</li>
        </ul>
      </section>

      <div class="reader-shell">
        <div class="reader-progress-wrapper" aria-hidden="true">
          <div class="reader-progress" data-reader-progress></div>
        </div>
        <div class="reader-head">
          <div>
            <p class="text-sm font-mono uppercase tracking-[0.2em] text-cuba-red">Lettura dinamica</p>
            <h2 class="font-pixel text-3xl leading-tight">Scorri il diario cubano</h2>
            <p class="reader-meta">Il corridoio costruisce le sezioni dal JSON. Se aggiungi tappe nel file dati, la pagina si aggiorna da sola.</p>
          </div>
          <div class="reader-counter" data-chunk-counter>0 / 0</div>
        </div>
        <div class="reader-stage">
          <div class="reader-track" data-reader-track></div>
          <div class="reader-dots" data-reader-dots aria-hidden="true"></div>
        </div>
        <button class="reader-fab" type="button" data-reader-next aria-label="Vai alla sezione successiva">↓</button>
      </div>

      <article class="hidden" data-text-source aria-hidden="true"></article>
    </main>
  </div>

  <script src="viaggi/reader.js"></script>
  <script>
    async function loadJournal() {
      const source = document.querySelector('[data-text-source]');
      if (!source) return;

      try {
        const response = await fetch('cuba_journal-data.json');
        if (!response.ok) throw new Error('Impossibile caricare i dati');
        const data = await response.json();

        const title = document.getElementById('page-title');
        const tagline = document.getElementById('page-tagline');
        const heroImage = document.getElementById('hero-image');
        const quoteText = document.getElementById('quote-text');
        const quoteAuthor = document.getElementById('quote-author');

        if (data.title && title) title.textContent = data.title;
        if (data.tagline && tagline) tagline.textContent = data.tagline;
        if (data.heroImage && heroImage) {
          heroImage.src = data.heroImage.src;
          heroImage.alt = data.heroImage.alt || '';
        }
        if (data.quote) {
          if (quoteText) quoteText.textContent = data.quote.text || '';
          if (quoteAuthor) quoteAuthor.textContent = data.quote.author || '';
        }

        source.innerHTML = '';

        data.sections?.forEach((section) => {
          const sectionEl = document.createElement('section');
          sectionEl.className = 'space-y-4';

          if (section.title) {
            const heading = document.createElement('h3');
            heading.className = 'font-pixel text-3xl border-l-8 border-cuba-red pl-3';
            heading.textContent = section.title;
            sectionEl.appendChild(heading);
          }

          section.paragraphs?.forEach((paragraph) => {
            const p = document.createElement('p');
            p.className = 'font-serif text-lg leading-relaxed';
            p.textContent = paragraph;
            sectionEl.appendChild(p);
          });

          if (section.highlights?.length) {
            const list = document.createElement('ul');
            list.className = 'list-disc list-inside space-y-2 font-sans text-cuba-blue/80';
            section.highlights.forEach((item) => {
              const li = document.createElement('li');
              li.textContent = item;
              list.appendChild(li);
            });
            sectionEl.appendChild(list);
          }

          if (section.image?.src) {
            const fig = document.createElement('figure');
            fig.className = 'space-y-3';
            const img = document.createElement('img');
            img.src = section.image.src;
            img.alt = section.image.alt || '';
            img.className = 'w-full border-4 border-cuba-blue shadow-neo-sm';
            fig.appendChild(img);
            sectionEl.appendChild(fig);
          }

          source.appendChild(sectionEl);
        });

        document.dispatchEvent(new Event('reader:update'));
      } catch (error) {
        console.error(error);
        const failure = document.createElement('p');
        failure.className = 'font-sans text-cuba-red text-lg';
        failure.textContent = 'Impossibile caricare il diario di Cuba. Riprova a ricaricare la pagina.';
        source.innerHTML = '';
        source.appendChild(failure);
        document.dispatchEvent(new Event('reader:update'));
      }
    }

    loadJournal();
  </script>
</body>
</html>
